import { Router } from 'express';
import { 
  getContratos,
  getContratoById,
  createContrato,
  updateContrato,
  deleteContrato,
  finalizarContrato,
  renovarContrato,
  getFacturasContrato
} from '../controllers/contratosController.js';
import { requireAuth } from '../auth/middlewareAuth.js';
import { requireRoles } from '../auth/middlewareRBAC.js';

const router = Router();

// Aplicar autenticación a todas las rutas
router.use(requireAuth);

/**
 * GET /api/contratos - Obtener lista de contratos
 * Acceso: ADMIN, OPERADOR
 */
router.get('/', 
  requireRoles('ADMIN', 'OPERADOR'),
  getContratos
);

/**
 * GET /api/contratos/:id - Obtener contrato por ID
 * Acceso: ADMIN, OPERADOR
 */
router.get('/:id', 
  requireRoles('ADMIN', 'OPERADOR'),
  getContratoById
);

/**
 * POST /api/contratos - Crear nuevo contrato
 * Acceso: ADMIN, OPERADOR
 */
router.post('/', 
  requireRoles('ADMIN', 'OPERADOR'),
  createContrato
);

/**
 * PUT /api/contratos/:id - Actualizar contrato
 * Acceso: ADMIN, OPERADOR
 */
router.put('/:id', 
  requireRoles('ADMIN', 'OPERADOR'),
  updateContrato
);

/**
 * POST /api/contratos/:id/finalizar - Finalizar contrato
 * Acceso: ADMIN, OPERADOR
 */
router.post('/:id/finalizar', 
  requireRoles('ADMIN', 'OPERADOR'),
  finalizarContrato
);

/**
 * POST /api/contratos/:id/renovar - Renovar contrato
 * Acceso: ADMIN, OPERADOR
 */
router.post('/:id/renovar', 
  requireRoles('ADMIN', 'OPERADOR'),
  renovarContrato
);

/**
 * GET /api/contratos/:id/facturas - Obtener facturas del contrato
 * Acceso: ADMIN, OPERADOR
 */
router.get('/:id/facturas', 
  requireRoles('ADMIN', 'OPERADOR'),
  getFacturasContrato
);

/**
 * DELETE /api/contratos/:id - Rescindir contrato
 * Acceso: ADMIN únicamente
 */
router.delete('/:id', 
  requireRoles('ADMIN'),
  deleteContrato
);

export default router;
